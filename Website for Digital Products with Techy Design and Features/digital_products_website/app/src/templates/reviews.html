{% extends 'base.html' %}

{% block title %}Customer Reviews - Digital Solutions Hub{% endblock %}

{% block content %}
<!-- Reviews Hero Section -->
<section class="page-hero">
    <div class="container">
        <div class="page-hero-content">
            <h1>Client <span class="text-gradient">Reviews</span></h1>
            <p>See what our clients have to say about working with us</p>
        </div>
    </div>
</section>

<!-- Reviews Section -->
<section class="reviews-section">
    <div class="container">
        <div class="reviews-grid">
            {% for review in reviews %}
            <div class="review-card animate-on-scroll">
                <div class="review-content">
                    <div class="rating">
                        {% for i in range(review.rating) %}
                        <i class="fas fa-star"></i>
                        {% endfor %}
                        {% if review.rating % 1 == 0.5 %}
                        <i class="fas fa-star-half-alt"></i>
                        {% endif %}
                        {% for i in range(5 - review.rating|int - (1 if review.rating % 1 == 0.5 else 0)) %}
                        <i class="far fa-star"></i>
                        {% endfor %}
                    </div>
                    <p>"{{ review.content }}"</p>
                </div>
                <div class="review-author">
                    <img src="{{ url_for('static', filename='images/' + review.image) if review.image else url_for('static', filename='images/default-avatar.png') }}" alt="{{ review.name }}">
                    <div class="author-info">
                        <h4>{{ review.name }}</h4>
                        <p>{{ review.company }}</p>
                        <p class="review-date">{{ review.date }}</p>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <!-- Pagination -->
        {% if pages > 1 %}
        <div class="pagination">
            {% if current_page > 1 %}
            <a href="{{ url_for('reviews', page=current_page-1) }}" class="pagination-item">
                <i class="fas fa-chevron-left"></i> Previous
            </a>
            {% endif %}
            
            {% for i in range(1, pages + 1) %}
            <a href="{{ url_for('reviews', page=i) }}" class="pagination-item {% if i == current_page %}active{% endif %}">
                {{ i }}
            </a>
            {% endfor %}
            
            {% if current_page < pages %}
            <a href="{{ url_for('reviews', page=current_page+1) }}" class="pagination-item">
                Next <i class="fas fa-chevron-right"></i>
            </a>
            {% endif %}
        </div>
        {% endif %}
    </div>
</section>

<!-- Submit Review Section -->
<section class="submit-review-section">
    <div class="container">
        <div class="section-header animate-on-scroll">
            <h2>Share Your <span class="text-gradient">Experience</span></h2>
            <p>We value your feedback. Let us know about your experience working with us.</p>
        </div>
        
        <div class="submit-review-container">
            {% if current_user.is_authenticated %}
            <div class="review-form animate-on-scroll">
                <form id="reviewForm" action="{{ url_for('submit_review') }}" method="POST">
                    <div class="form-group">
                        <label for="rating">Rating</label>
                        <div class="star-rating">
                            <input type="radio" id="star5" name="rating" value="5" required>
                            <label for="star5" title="5 stars"><i class="far fa-star"></i></label>
                            
                            <input type="radio" id="star4" name="rating" value="4">
                            <label for="star4" title="4 stars"><i class="far fa-star"></i></label>
                            
                            <input type="radio" id="star3" name="rating" value="3">
                            <label for="star3" title="3 stars"><i class="far fa-star"></i></label>
                            
                            <input type="radio" id="star2" name="rating" value="2">
                            <label for="star2" title="2 stars"><i class="far fa-star"></i></label>
                            
                            <input type="radio" id="star1" name="rating" value="1">
                            <label for="star1" title="1 star"><i class="far fa-star"></i></label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="company">Company/Organization (Optional)</label>
                        <input type="text" id="company" name="company" class="form-control">
                    </div>
                    
                    <div class="form-group">
                        <label for="review">Your Review</label>
                        <textarea id="review" name="review" class="form-control" rows="5" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Submit Review</button>
                    </div>
                </form>
            </div>
            {% else %}
            <div class="login-prompt animate-on-scroll">
                <div class="login-prompt-content">
                    <i class="fas fa-user-circle"></i>
                    <h3>Please Log In to Submit a Review</h3>
                    <p>You need to be logged in to share your experience with us.</p>
                    <div class="login-prompt-buttons">
                        <a href="{{ url_for('login') }}" class="btn btn-primary">Log In</a>
                        <a href="{{ url_for('register') }}" class="btn btn-outline">Sign Up</a>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</section>

<!-- Testimonial Videos Section -->
<section class="testimonial-videos">
    <div class="container">
        <div class="section-header animate-on-scroll">
            <h2>Video <span class="text-gradient">Testimonials</span></h2>
            <p>Watch what our clients have to say about their experience working with us.</p>
        </div>
        
        <div class="videos-grid">
            <div class="video-card animate-on-scroll">
                <div class="video-container">
                    <iframe width="100%" height="250" src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                </div>
                <div class="video-info">
                    <h4>TechStart Success Story</h4>
                    <p>Sarah Johnson, CEO of TechStart, discusses how our services helped grow their business.</p>
                </div>
            </div>
            
            <div class="video-card animate-on-scroll">
                <div class="video-container">
                    <iframe width="100%" height="250" src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                </div>
                <div class="video-info">
                    <h4>GrowthLabs Case Study</h4>
                    <p>Michael Chen explains how our Facebook Ads strategy delivered exceptional results.</p>
                </div>
            </div>
            
            <div class="video-card animate-on-scroll">
                <div class="video-container">
                    <iframe width="100%" height="250" src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                </div>
                <div class="video-info">
                    <h4>SalesPro Transformation</h4>
                    <p>Emily Rodriguez shares how our cold email marketing strategy transformed their sales process.</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- CTA Section -->
<section class="cta">
    <div class="container">
        <div class="cta-content animate-on-scroll">
            <h2>Ready to Join Our Success Stories?</h2>
            <p>Get in touch with us today to discuss how we can help your business grow online.</p>
            <div class="cta-buttons">
                <a href="{{ url_for('contact') }}" class="btn btn-primary">Contact Us</a>
                <a href="{{ url_for('services') }}" class="btn btn-outline">Explore Services</a>
            </div>
        </div>
    </div>
</section>

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Star rating functionality
        const starLabels = document.querySelectorAll('.star-rating label');
        const starInputs = document.querySelectorAll('.star-rating input');
        
        if (starLabels.length > 0 && starInputs.length > 0) {
            // Update stars on hover
            starLabels.forEach((label, index) => {
                label.addEventListener('mouseover', () => {
                    // Fill in stars up to the hovered one
                    for (let i = 0; i <= index; i++) {
                        starLabels[i].querySelector('i').className = 'fas fa-star';
                    }
                    
                    // Empty stars after the hovered one
                    for (let i = index + 1; i < starLabels.length; i++) {
                        starLabels[i].querySelector('i').className = 'far fa-star';
                    }
                });
            });
            
            // Reset stars when mouse leaves the rating container
            document.querySelector('.star-rating').addEventListener('mouseleave', () => {
                // Check which star is selected
                let selectedIndex = -1;
                starInputs.forEach((input, index) => {
                    if (input.checked) {
                        selectedIndex = index;
                    }
                });
                
                // Fill in stars up to the selected one
                for (let i = 0; i <= selectedIndex; i++) {
                    starLabels[i].querySelector('i').className = 'fas fa-star';
                }
                
                // Empty stars after the selected one
                for (let i = selectedIndex + 1; i < starLabels.length; i++) {
                    starLabels[i].querySelector('i').className = 'far fa-star';
                }
            });
            
            // Update stars when a rating is selected
            starInputs.forEach((input, index) => {
                input.addEventListener('change', () => {
                    if (input.checked) {
                        // Fill in stars up to the selected one
                        for (let i = 0; i <= index; i++) {
                            starLabels[i].querySelector('i').className = 'fas fa-star';
                        }
                        
                        // Empty stars after the selected one
                        for (let i = index + 1; i < starLabels.length; i++) {
                            starLabels[i].querySelector('i').className = 'far fa-star';
                        }
                    }
                });
            });
        }
        
        // Form validation
        const reviewForm = document.getElementById('reviewForm');
        
        if (reviewForm) {
            reviewForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Basic validation
                let isValid = true;
                const rating = document.querySelector('input[name="rating"]:checked');
                const review = document.getElementById('review');
                
                // Clear previous error messages
                document.querySelectorAll('.error-message').forEach(el => el.remove());
                
                // Validate rating
                if (!rating) {
                    isValid = false;
                    showError(document.querySelector('.star-rating'), 'Please select a rating');
                }
                
                // Validate review
                if (!review.value.trim()) {
                    isValid = false;
                    showError(review, 'Please enter your review');
                }
                
                if (isValid) {
                    // Show success message
                    const successMessage = document.createElement('div');
                    successMessage.className = 'success-message';
                    successMessage.textContent = 'Thank you for your review! It will be published after moderation.';
                    reviewForm.innerHTML = '';
                    reviewForm.appendChild(successMessage);
                    
                    // In a real implementation, this would submit to the server
                    // reviewForm.submit();
                }
            });
        }
        
        function showError(element, message) {
            const errorMessage = document.createElement('div');
            errorMessage.className = 'error-message';
            errorMessage.textContent = message;
            element.parentElement.appendChild(errorMessage);
            if (element.classList) {
                element.classList.add('error');
            }
        }
    });
</script>
{% endblock %}
{% endblock %}
